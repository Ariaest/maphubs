var config = require('./webpack.config');
var webpack = require('webpack');
var AssetsPlugin = require('assets-webpack-plugin');
var path = require('path');
var version = require('../package.json').version;
var ExtractTextPlugin = require("extract-text-webpack-plugin");

config.devtool = "cheap-module-source-map";
config.output.filename = "[name].[chunkhash].js";
//replace the extract text plugin (must be the last one added in main config)
config.plugins[config.plugins.length - 1] = new ExtractTextPlugin({filename: "[name].[chunkhash].css"});
config.plugins.push(new webpack.LoaderOptionsPlugin({minimize: true, debug: false}));
config.plugins.push(new webpack.DefinePlugin({
  'process.env': {
    NODE_ENV: JSON.stringify('production')
  }
}));
config.plugins.push(new webpack.optimize.UglifyJsPlugin({
  minimize: true,  
  sourceMap: true,
  beautify: false,
  mangle: {
    screw_ie8: true,
    keep_fnames: true
  },
  compress: {
    screw_ie8: true
  },
  comments: false
}));
config.plugins.push(new AssetsPlugin({
    path: path.join(__dirname, '../src'),
    prettyPrint: true, update: true, metadata: {version: version}}));


module.exports = config;
